!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-collection"),require("d3-dispatch"),require("d3-dsv")):"function"==typeof define&&define.amd?define(["exports","d3-collection","d3-dispatch","d3-dsv"],n):n(e.d3_request=e.d3_request||{},e.d3_collection,e.d3_dispatch,e.d3_dsv)}(this,function(e,n,t,r){"use strict";function o(e,r){function o(e){var n,t=d.status;if(!t&&s(d)||t>=200&&300>t||304===t){if(c)try{n=c.call(l,d)}catch(r){return void p.call("error",l,r)}else n=d;p.call("load",l,n)}else p.call("error",l,e)}var l,i,c,a,p=t.dispatch("beforesend","progress","load","error"),f=n.map(),d=new XMLHttpRequest,h=null,m=null,v=0;return"undefined"==typeof XDomainRequest||"withCredentials"in d||!/^(http(s)?:)?\/\//.test(e)||(d=new XDomainRequest),"onload"in d?d.onload=d.onerror=d.ontimeout=o:d.onreadystatechange=function(e){d.readyState>3&&o(e)},d.onprogress=function(e){p.call("progress",l,e)},l={header:function(e,n){return e=(e+"").toLowerCase(),arguments.length<2?f.get(e):(null==n?f.remove(e):f.set(e,n+""),l)},mimeType:function(e){return arguments.length?(i=null==e?null:e+"",l):i},responseType:function(e){return arguments.length?(a=e,l):a},timeout:function(e){return arguments.length?(v=+e,l):v},user:function(e){return arguments.length<1?h:(h=null==e?null:e+"",l)},password:function(e){return arguments.length<1?m:(m=null==e?null:e+"",l)},response:function(e){return c=e,l},get:function(e,n){return l.send("GET",e,n)},post:function(e,n){return l.send("POST",e,n)},send:function(n,t,r){return r||"function"!=typeof t||(r=t,t=null),r&&1===r.length&&(r=u(r)),d.open(n,e,!0,h,m),null==i||f.has("accept")||f.set("accept",i+",*/*"),d.setRequestHeader&&f.each(function(e,n){d.setRequestHeader(n,e)}),null!=i&&d.overrideMimeType&&d.overrideMimeType(i),null!=a&&(d.responseType=a),v>0&&(d.timeout=v),r&&l.on("error",r).on("load",function(e){r(null,e)}),p.call("beforesend",l,d),d.send(null==t?null:t),l},abort:function(){return d.abort(),l},on:function(){var e=p.on.apply(p,arguments);return e===p?l:e}},r?l.get(r):l}function u(e){return function(n,t){e(null==n?t:null)}}function s(e){var n=e.responseType;return n&&"text"!==n?e.response:e.responseText}function l(e,n){return function(t,r){var u=o(t).mimeType(e).response(n);return r?u.get(r):u}}function i(e,n){return function(t,r,u){arguments.length<3&&(u=r,r=null);var s=o(t).mimeType(e);return s.row=function(e){return arguments.length?s.response(c(n,r=e)):r},s.row(r),u?s.get(u):s}}function c(e,n){return function(t){return e(t.responseText,n)}}var a="0.4.5",p=l("text/html",function(e){return document.createRange().createContextualFragment(e.responseText)}),f=l("application/json",function(e){return JSON.parse(e.responseText)}),d=l("text/plain",function(e){return e.responseText}),h=l("application/xml",function(e){var n=e.responseXML;if(!n)throw new Error("parse error");return n}),m=i("text/csv",r.csvParse),v=i("text/tab-separated-values",r.tsvParse);e.version=a,e.request=o,e.html=p,e.json=f,e.text=d,e.xml=h,e.csv=m,e.tsv=v});